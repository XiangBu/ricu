<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Low level functions for loading data — load_src • ICU data with R</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Low level functions for loading data — load_src" />
<meta property="og:description" content="Data loading involves a cascade of S3 generic functions, which can
individually be adapted to the specifics of individual data sources. A the
lowest level, load_scr is called, followed by load_difftime().
Functions up the chain, are described in load_id()." />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ICU data with R</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/jss.pdf">\pkg{ricu}: \proglang{R}'s interface for ICU data (PDF)</a>
    </li>
    <li>
      <a href="../articles/uom.html">Units of measurement</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/septic-tank/ricu">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Low level functions for loading data</h1>
    
    <div class="hidden name"><code>load_src.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Data loading involves a cascade of S3 generic functions, which can
individually be adapted to the specifics of individual data sources. A the
lowest level, <code>load_scr</code> is called, followed by <code>load_difftime()</code>.
Functions up the chain, are described in <code><a href='load_id.html'>load_id()</a></code>.</p>
    </div>

    <pre class="usage"><span class='fu'>load_src</span>(<span class='kw'>x</span>, <span class='kw'>...</span>)

<span class='co'># S3 method for src_tbl</span>
<span class='fu'>load_src</span>(<span class='kw'>x</span>, <span class='kw'>rows</span>, cols = <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='kw'>x</span>), <span class='kw'>...</span>)

<span class='co'># S3 method for character</span>
<span class='fu'>load_src</span>(<span class='kw'>x</span>, <span class='kw'>src</span>, <span class='kw'>...</span>)

<span class='fu'>load_difftime</span>(<span class='kw'>x</span>, <span class='kw'>...</span>)

<span class='co'># S3 method for mimic_tbl</span>
<span class='fu'>load_difftime</span>(
  <span class='kw'>x</span>,
  <span class='kw'>rows</span>,
  cols = <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='kw'>x</span>),
  id_hint = <span class='fu'><a href='id_vars.html'>id_vars</a></span>(<span class='kw'>x</span>),
  time_vars = <span class='kw'>ricu</span>::<span class='fu'><a href='id_vars.html'>time_vars</a></span>(<span class='kw'>x</span>),
  <span class='kw'>...</span>
)

<span class='co'># S3 method for eicu_tbl</span>
<span class='fu'>load_difftime</span>(
  <span class='kw'>x</span>,
  <span class='kw'>rows</span>,
  cols = <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='kw'>x</span>),
  id_hint = <span class='fu'><a href='id_vars.html'>id_vars</a></span>(<span class='kw'>x</span>),
  time_vars = <span class='kw'>ricu</span>::<span class='fu'><a href='id_vars.html'>time_vars</a></span>(<span class='kw'>x</span>),
  <span class='kw'>...</span>
)

<span class='co'># S3 method for hirid_tbl</span>
<span class='fu'>load_difftime</span>(
  <span class='kw'>x</span>,
  <span class='kw'>rows</span>,
  cols = <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='kw'>x</span>),
  id_hint = <span class='fu'><a href='id_vars.html'>id_vars</a></span>(<span class='kw'>x</span>),
  time_vars = <span class='kw'>ricu</span>::<span class='fu'><a href='id_vars.html'>time_vars</a></span>(<span class='kw'>x</span>),
  <span class='kw'>...</span>
)

<span class='co'># S3 method for character</span>
<span class='fu'>load_difftime</span>(<span class='kw'>x</span>, <span class='kw'>src</span>, <span class='kw'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>Object for which to load data</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Generic consistency</p></td>
    </tr>
    <tr>
      <th>rows</th>
      <td><p>Expression used for row subsetting (NSE)</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>Character vector of column names</p></td>
    </tr>
    <tr>
      <th>src</th>
      <td><p>Passed to <code><a href='attach_src.html'>as_src_tbl()</a></code> in order to determine the data source</p></td>
    </tr>
    <tr>
      <th>id_hint</th>
      <td><p>String valued id column selection (not necessarily honored)</p></td>
    </tr>
    <tr>
      <th>time_vars</th>
      <td><p>Character vector enumerating the columns to be treated as
timestamps and thus returned as <code><a href='https://rdrr.io/r/base/difftime.html'>base::difftime()</a></code> vectors</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>A function extending the S3 generic <code>load_src()</code> is expected to load a
subset of rows/columns from a tabular data source. While the column
specification is provided as character vector of column names, the row
subsetting involves non-standard evaluation (NSE). Data-sets that are
included with <code>ricu</code> are represented by <code><a href='https://rdrr.io/pkg/prt/man/new_prt.html'>prt</a></code> objects,
which use <code><a href='https://rlang.r-lib.org/reference/eval_tidy.html'>rlang::eval_tidy()</a></code> to evaluate NSE expressions. Furthermore,
<code>prt</code> objects potentially represent tabular data split into partitions and
row-subsetting expressions are evaluated per partition (see the <code>part_safe</code>
flag in <code><a href='https://rdrr.io/pkg/prt/man/nse.html'>prt::subset.prt()</a></code>). The return value of <code>load_src()</code> is expected
to be of type <code>data.table</code>.</p>
<p>Timestamps are represented differently among the included data sources:
while MIMIC-III and HiRID use absolute date/times, eICU provides temporal
information as minutes relative to ICU admission. Other data sources, such
as the ICU dataset provided by Amsterdam UMC, opt for relative times as
well, but not in minutes since admission, but in milliseconds. In order to
smoothen out such discrepancies, the next function in the data loading
hierarchy is <code>load_difftime()</code>. This function is expected to call
<code>load_src()</code> in order to load a subset of rows/columns from a table stored
on disk and convert all columns that represent timestamps (as specified by
the argument <code>time_vars</code>) into <code><a href='https://rdrr.io/r/base/difftime.html'>base::difftime()</a></code> vectors using <code>mins</code> as
time unit.</p>
<p>The returned object should be of type <code>id_tbl</code>, with the ID vars
identifying the ID system the times are relative to. If for example all
times are relative to ICU admission, the ICU stay ID should be returned as
ID column. The argument <code>id_hint</code> may suggest an ID type, but if in the raw
data, this ID is not available, <code>load_difftime()</code> may return data using a
different ID system. In MIMIC-III, for example, data in the <code>labevents</code>
table is available for <code>subject_id</code> (patient ID) pr <code>hadm_id</code> (hospital
admission ID). If data is requested for <code>icustay_id</code> (ICU stay ID), this
request cannot be fulfilled and data is returned using the ID system with
the highest cardinality (among the available ones). Utilities such as
<code><a href='change_id.html'>change_id()</a></code> can the later be used to resolve data to <code>icustay_id</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='kw'>tbl</span> <span class='op'>&lt;-</span> <span class='kw'>mimic_demo</span><span class='op'>$</span><span class='kw'>labevents</span>
</div><div class='output co'>#&gt; <span class='message'>Cannot update read-only data source `mimic_demo`</span></div><div class='input'><span class='kw'>col</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"charttime"</span>, <span class='st'>"value"</span>)

<span class='fu'>load_src</span>(<span class='kw'>tbl</span>, <span class='kw'>itemid</span> <span class='op'>==</span> <span class='fl'>50809</span>)
</div><div class='output co'>#&gt;        row_id subject_id hadm_id itemid           charttime value valuenum
#&gt;   1:  6245910      10006      NA  50809 2165-02-22 11:36:00    77       77
#&gt;   2:  6250050      10019  177759  50809 2163-05-14 20:07:00   146      146
#&gt;   3:  6250095      10019  177759  50809 2163-05-14 22:12:00   158      158
#&gt;   4:  6250102      10019  177759  50809 2163-05-14 23:11:00   150      150
#&gt;   5:  6250113      10019  177759  50809 2163-05-15 00:00:00   159      159
#&gt;  ---                                                                      
#&gt; 279: 20434896      44083  125157  50809 2112-05-04 17:07:00   144      144
#&gt; 280: 20434911      44083  125157  50809 2112-05-04 21:05:00   163      163
#&gt; 281: 20439454      44154  174245  50809 2178-05-14 16:52:00   164      164
#&gt; 282: 20448342      44212  163189  50809 2123-12-09 12:25:00   117      117
#&gt; 283: 20448362      44212  163189  50809 2123-12-09 18:09:00    99       99
#&gt;      valueuom     flag
#&gt;   1:    mg/dL     &lt;NA&gt;
#&gt;   2:    mg/dL abnormal
#&gt;   3:    mg/dL abnormal
#&gt;   4:    mg/dL abnormal
#&gt;   5:    mg/dL abnormal
#&gt;  ---                  
#&gt; 279:    mg/dL abnormal
#&gt; 280:    mg/dL abnormal
#&gt; 281:    mg/dL abnormal
#&gt; 282:    mg/dL abnormal
#&gt; 283:    mg/dL     &lt;NA&gt;</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(
  <span class='fu'>load_src</span>(<span class='st'>"labevents"</span>, <span class='st'>"mimic_demo"</span>, <span class='kw'>itemid</span> <span class='op'>==</span> <span class='fl'>50809</span>, cols = <span class='kw'>col</span>)
)
</div><div class='output co'>#&gt; [1] "charttime" "value"    </div><div class='input'>
<span class='fu'>load_difftime</span>(<span class='kw'>tbl</span>, <span class='kw'>itemid</span> <span class='op'>==</span> <span class='fl'>50809</span>)
</div><div class='output co'>#&gt; <span class='message'>No overlap between configured id var options and available columns for table</span>
#&gt; <span class='message'>`labevents` in mimic_demo</span></div><div class='output co'>#&gt; <span style='color: #555555;'># An `id_tbl`: 276 ✖ 9</span><span>
#&gt; </span><span style='color: #555555;'># Id var:      `hadm_id`</span><span>
#&gt;     hadm_id   row_id subject_id itemid charttime value valuenum valueuom flag   
#&gt;       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;drtn&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>  
#&gt; </span><span style='color: #555555;'>1</span><span>    </span><span style='text-decoration: underline;'>100</span><span>969 20</span><span style='text-decoration: underline;'>237</span><span>172      </span><span style='text-decoration: underline;'>42</span><span>430  </span><span style='text-decoration: underline;'>50</span><span>809 -177 mins 273        273 mg/dL    abnorm…
#&gt; </span><span style='color: #555555;'>2</span><span>    </span><span style='text-decoration: underline;'>104</span><span>697 19</span><span style='text-decoration: underline;'>993</span><span>476      </span><span style='text-decoration: underline;'>40</span><span>612  </span><span style='text-decoration: underline;'>50</span><span>809  128 mins 118        118 mg/dL    abnorm…
#&gt; </span><span style='color: #555555;'>3</span><span>    </span><span style='text-decoration: underline;'>107</span><span>689 20</span><span style='text-decoration: underline;'>173</span><span>434      </span><span style='text-decoration: underline;'>41</span><span>983  </span><span style='text-decoration: underline;'>50</span><span>809 -178 mins 105        105 mg/dL    </span><span style='color: #BB0000;'>NA</span><span>     
#&gt; </span><span style='color: #555555;'>4</span><span>    </span><span style='text-decoration: underline;'>110</span><span>244  6</span><span style='text-decoration: underline;'>253</span><span>811      </span><span style='text-decoration: underline;'>10</span><span>035  </span><span style='text-decoration: underline;'>50</span><span>809 1932 mins 105        105 mg/dL    </span><span style='color: #BB0000;'>NA</span><span>     
#&gt; </span><span style='color: #555555;'>5</span><span>    </span><span style='text-decoration: underline;'>110</span><span>958 20</span><span style='text-decoration: underline;'>416</span><span>364      </span><span style='text-decoration: underline;'>43</span><span>927  </span><span style='text-decoration: underline;'>50</span><span>809 -220 mins 99          99 mg/dL    </span><span style='color: #BB0000;'>NA</span><span>     
#&gt; </span><span style='color: #555555;'>…</span><span>                    
#&gt; </span><span style='color: #555555;'>272</span><span>  </span><span style='text-decoration: underline;'>199</span><span>395  6</span><span style='text-decoration: underline;'>251</span><span>511      </span><span style='text-decoration: underline;'>10</span><span>027  </span><span style='text-decoration: underline;'>50</span><span>809 5488 mins 152        152 mg/dL    abnorm…
#&gt; </span><span style='color: #555555;'>273</span><span>  </span><span style='text-decoration: underline;'>199</span><span>395  6</span><span style='text-decoration: underline;'>251</span><span>524      </span><span style='text-decoration: underline;'>10</span><span>027  </span><span style='text-decoration: underline;'>50</span><span>809 6705 mins 146        146 mg/dL    abnorm…
#&gt; </span><span style='color: #555555;'>274</span><span>  </span><span style='text-decoration: underline;'>199</span><span>395  6</span><span style='text-decoration: underline;'>251</span><span>546      </span><span style='text-decoration: underline;'>10</span><span>027  </span><span style='text-decoration: underline;'>50</span><span>809 6960 mins 108        108 mg/dL    abnorm…
#&gt; </span><span style='color: #555555;'>275</span><span>  </span><span style='text-decoration: underline;'>199</span><span>395  6</span><span style='text-decoration: underline;'>251</span><span>577      </span><span style='text-decoration: underline;'>10</span><span>027  </span><span style='text-decoration: underline;'>50</span><span>809 8270 mins 58          58 mg/dL    abnorm…
#&gt; </span><span style='color: #555555;'>276</span><span>  </span><span style='text-decoration: underline;'>199</span><span>395  6</span><span style='text-decoration: underline;'>251</span><span>586      </span><span style='text-decoration: underline;'>10</span><span>027  </span><span style='text-decoration: underline;'>50</span><span>809 8538 mins 88          88 mg/dL    </span><span style='color: #BB0000;'>NA</span><span>     
#&gt; </span><span style='color: #555555;'># … with 266 more rows</span><span></div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(
  <span class='fu'>load_difftime</span>(<span class='kw'>tbl</span>, <span class='kw'>itemid</span> <span class='op'>==</span> <span class='fl'>50809</span>, <span class='kw'>col</span>)
)
</div><div class='output co'>#&gt; <span class='message'>No overlap between configured id var options and available columns for table</span>
#&gt; <span class='message'>`labevents` in mimic_demo</span></div><div class='output co'>#&gt; [1] "hadm_id"   "charttime" "value"    </div><div class='input'>
<span class='fu'><a href='id_vars.html'>id_vars</a></span>(
  <span class='fu'>load_difftime</span>(<span class='kw'>tbl</span>, <span class='kw'>itemid</span> <span class='op'>==</span> <span class='fl'>50809</span>, id_hint = <span class='st'>"icustay_id"</span>)
)
</div><div class='output co'>#&gt; <span class='message'>No overlap between configured id var options and available columns for table</span>
#&gt; <span class='message'>`labevents` in mimic_demo</span></div><div class='output co'>#&gt; [1] "hadm_id"</div><div class='input'>
<span class='fu'><a href='id_vars.html'>id_vars</a></span>(
  <span class='fu'>load_difftime</span>(<span class='kw'>tbl</span>, <span class='kw'>itemid</span> <span class='op'>==</span> <span class='fl'>50809</span>, id_hint = <span class='st'>"subject_id"</span>)
)
</div><div class='output co'>#&gt; [1] "subject_id"</div><div class='input'>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nicolas Bennett, Drago Plecko, Ida-Fong Ukor.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


