<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Data attach utilities — attach_src • ICU data with R</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Data attach utilities — attach_src" />
<meta property="og:description" content="Making a dataset available to ricu consists of 3 steps: downloading
(download_src()), importing (import_src()) and attaching
(attach_src()). While downloading and importing are one-time procedures,
attaching of the dataset is repeated every time the package is loaded.
Briefly, downloading loads the raw dataset from the internet (most likely
in .csv format), importing consists of some preprocessing to make the
data available more efficiently and attaching sets up the data for use by
the package." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ICU data with R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/uom.html">Units of measurement</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/septic-tank/ricu">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Data attach utilities</h1>
    
    <div class="hidden name"><code>attach_src.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Making a dataset available to <code>ricu</code> consists of 3 steps: downloading
(<code><a href='download_src.html'>download_src()</a></code>), importing (<code><a href='import_src.html'>import_src()</a></code>) and attaching
(<code>attach_src()</code>). While downloading and importing are one-time procedures,
attaching of the dataset is repeated every time the package is loaded.
Briefly, downloading loads the raw dataset from the internet (most likely
in <code>.csv</code> format), importing consists of some preprocessing to make the
data available more efficiently and attaching sets up the data for use by
the package.</p>
    </div>

    <pre class="usage"><span class='fu'>attach_src</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for src_cfg</span>
<span class='fu'>attach_src</span><span class='op'>(</span><span class='va'>x</span>, assign_env <span class='op'>=</span> <span class='va'>.GlobalEnv</span>, data_dir <span class='op'>=</span> <span class='fu'><a href='data_dir.html'>src_data_dir</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for character</span>
<span class='fu'>attach_src</span><span class='op'>(</span><span class='va'>x</span>, assign_env <span class='op'>=</span> <span class='va'>.GlobalEnv</span>, data_dir <span class='op'>=</span> <span class='fu'><a href='data_dir.html'>src_data_dir</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>setup_src_env</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>env</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for src_cfg</span>
<span class='fu'>setup_src_env</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>env</span>, data_dir <span class='op'>=</span> <span class='fu'><a href='data_dir.html'>src_data_dir</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>new_src_tbl</span><span class='op'>(</span><span class='va'>files</span>, <span class='va'>col_cfg</span>, <span class='va'>tbl_cfg</span>, <span class='va'>prefix</span>, <span class='va'>src_env</span><span class='op'>)</span>

<span class='fu'>as_src_tbl</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>new_src_env</span><span class='op'>(</span><span class='va'>x</span>, env <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>new.env</a></span><span class='op'>(</span>parent <span class='op'>=</span> <span class='fu'>data_env</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>as_src_env</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>Data source to attach</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Forwarded to further calls to <code>attach_src()</code></p></td>
    </tr>
    <tr>
      <th>assign_env</th>
      <td><p>Environment in which the data source will become available</p></td>
    </tr>
    <tr>
      <th>data_dir</th>
      <td><p>Directory used to look for <code><a href='http://www.fstpackage.org/reference/fst.html'>fst::fst()</a></code> files; <code>NULL</code> calls
<code><a href='data_dir.html'>data_dir()</a></code> using the source name as <code>subdir</code> argument</p></td>
    </tr>
    <tr>
      <th>env</th>
      <td><p>Environment where data proxy objects are created</p></td>
    </tr>
    <tr>
      <th>files</th>
      <td><p>File names of <code>fst</code> files that will be used to create a <code>prt</code>
object (see also <code><a href='https://nbenn.github.io/prt/reference/new_prt.html'>prt::new_prt()</a></code>)</p></td>
    </tr>
    <tr>
      <th>col_cfg</th>
      <td><p>Coerced to <code>col_cfg</code> by calling <code><a href='new_src_cfg.html'>as_col_cfg()</a></code></p></td>
    </tr>
    <tr>
      <th>tbl_cfg</th>
      <td><p>Coerced to <code>tbl_cfg</code> by calling <code><a href='new_src_cfg.html'>as_tbl_cfg()</a></code></p></td>
    </tr>
    <tr>
      <th>prefix</th>
      <td><p>Character vector valued data source name(s) (used as class
prefix)</p></td>
    </tr>
    <tr>
      <th>src_env</th>
      <td><p>The data source environment (as <code>src_env</code> object)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Attaching a dataset sets up two types of S3 classes: a single <code>src_env</code>
object, containing as many <code>src_tbl</code> objects as tables are associated with
the dataset. A <code>src_env</code> is an environment with an <code>id_cfg</code> attribute, as
well as sub-classes as specified by the data source <code>class_prefix</code>
configuration setting (see <code><a href='load_src_cfg.html'>load_src_cfg()</a></code>). All <code>src_env</code> objects created
by calling <code>attach_src()</code> represent environments that are direct
descendants of the <code>data</code> environment and are bound to the respective
dataset name within that environment. While <code>attach_src()</code> does not
immediately instantiate a <code>src_env</code> object, it rather creates a promise
using <code><a href='https://rdrr.io/r/base/delayedAssign.html'>base::delayedAssign()</a></code> which evaluates to a <code>src_env</code> upon first
access. This allows for data sources to be set up where the data is missing
in a way that prompts the user to download and import the data when first
accessed.</p>
<p>Additionally, <code>attach_src()</code> creates an active binding using
<code><a href='https://rdrr.io/r/base/bindenv.html'>base::makeActiveBinding()</a></code>, binding a function to the dataset name within
the environment passed as <code>assign_env</code>, which retrieves the respective
<code>src_env</code> from the <code>data</code> environment. This shortcut is set up for
convenience, such that for example the MIMIC-III demo dataset not only is
available as <code>ricu::data::mimic_demo</code>, but also as <code><a href='data.html'>ricu::mimic_demo</a></code> (or if
the package namespace is attached, simply as <code>mimic_demo</code>). The <code>ricu</code>
namespace contains objects <code>mimic</code>, <code>mimic_demo</code>, <code>eicu</code>, etc. which are
used as such links when loading the package. However, new data sets can be
set up an accessed in the same way.</p>
<p>If set up correctly, it is not necessary for the user to directly call
<code>attach_src()</code>. When the package is loaded, the default data sources are
attached automatically. This default can be controlled by setting as
environment variable <code>RICU_SRC_LOAD</code> a comma separated list of data source
names before loading the library. Setting this environment variable as</p><pre><span class='fu'><a href='https://rdrr.io/r/base/Sys.setenv.html'>Sys.setenv</a></span><span class='op'>(</span>RICU_SRC_LOAD <span class='op'>=</span> <span class='st'>"mimic_demo,eciu_demo"</span><span class='op'>)</span>
</pre>

<p>will change the default of loading both MIMIC-III and eICU, alongside the
respective demo datasets, and HiRID, to just the two demo datasets. For
setting an environment variable upon startup of the R session, refer to
<code><a href='https://rdrr.io/r/base/Startup.html'>base::.First.sys()</a></code>.</p>
<p>The <code>src_env</code> promise for each data source is created using the S3 generic
function <code>setup_src_env()</code>. This function checks if all required files are
available from <code>data_dir</code>. If files are missing the user is prompted for
download in interactive sessions and an error is thrown otherwise. As soon
as all required data is available, a <code>src_tbl</code> object is created per table
and assigned to the <code>src_env</code>.</p>
<p>The S3 class <code>src_tbl</code> inherits from <code><a href='https://nbenn.github.io/prt/reference/new_prt.html'>prt</a></code>, which
represents a partitioned <code><a href='http://www.fstpackage.org/reference/fst.html'>fst</a></code> file. In addition to the <code>prt</code>
object, meta data in the form of <code>col_cfg</code> and <code>tbl_cfg</code> is associated with
a <code>src_tbl</code> object (see <code><a href='load_src_cfg.html'>load_src_cfg()</a></code>). Furthermore, as with <code>src_env</code>,
sub-classes are added as specified by the source configuration
<code>class_prefix</code> entry. This allows certain functionality, for example data
loading, to be adapted to data source-specific requirements.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>

<span class='fu'><a href='https://rdrr.io/r/base/Sys.setenv.html'>Sys.setenv</a></span><span class='op'>(</span>RICU_SRC_LOAD <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/septic-tank/ricu'>ricu</a></span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span>envir <span class='op'>=</span> <span class='va'>data</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/exists.html'>exists</a></span><span class='op'>(</span><span class='st'>"mimic_demo"</span><span class='op'>)</span>

<span class='fu'>attach_src</span><span class='op'>(</span><span class='st'>"mimic_demo"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span>envir <span class='op'>=</span> <span class='va'>data</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/exists.html'>exists</a></span><span class='op'>(</span><span class='st'>"mimic_demo"</span><span class='op'>)</span>

<span class='va'>mimic_demo</span>

<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nicolas Bennett, Drago Plecko, Ida-Fong Ukor.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


